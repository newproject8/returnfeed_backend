ㅁ 소개

안녕 무언가 일이 꼬인것 같아.
너를 통해서 해결하길 원해

나는 정말 완전 초보자야 너와 같은 ai를 이용해 일을 해결해 가고 있어
일도 해결하고 해결하는 과정에서 내 총체적인 이해도 넓히길 원해


ㅁ 개요

서버 문제야
헤놀로지 서버를 쓰고 있었거든
최근 우분투 노트북을 추가했어.

returnfeed.net 이란 도메인을 샀는데
호스팅하는 과정에서 문제가 생긴거 같아


ㅁ 시스템들 정보

ㅇ 도메인 :
returnfeed.net

ㅇ 퍼블릭아이피
203.234.214.201

현재 모든 네트워크는 1개의 itpime 공유기로 연결되어 있다.
1) 우분투 노트북 | 192.168.0.242
2) 현재 너와 이야기하는 이 피씨 (헤놀로지 제어도 이것으로 한다) | 192.168.0.10
3) 헤놀로지 컴퓨터 | 192.168.0.166

헤놀로지는 역방향 프록시가 시스템 사용중이라며 80, 443을 설정 불가능하다. (해결법 제외한다)



ㅁ iptime 포트포워딩 현재 설정

사용자 규칙(10/500)프로토콜외부 포트내부 IP내부 포트001nas2_webstationTCP80192.168.0.24280002 nas2_webstation_httpsTCP443192.168.0.242443003nas2_returnfeed_srtUDP8890192.168.0.2428890004nas2_returnfeed_webrtcTCP8889192.168.0.2428889005nas2_returnfeed_webrtc_ice_rtpUDP8189192.168.0.2428189006nas2_tallyserver_testTCP8765192.168.0.2428765007NAS포트포워딩TCP/UDP445192.168.0.176445008NAS포트포워딩2TCP/UDP5006192.168.0.1765006009네트워크드라이브접근TCP/UDP5006192.168.0.1765006010젤리핀외부접속TCP/UDP44444192.168.0.1668096

ㅁ 내가 격는 문제

returnfeed.net에 접속이 안된다.
헤놀로지 웹스테이션을 지웠을 경우는 접속이 됬다.
헤놀로지 웹스테이션이 있어야만 작동하는 젤리핀 영상 스트림이 헤놀로지 컨테이너에 있다.


ㅁ 질문

내 생각엔 뭔가 포트 충돌이나? 설정문제 그런게 아닐까?
우분투랑 헤놀로지의 웹스테이션이 충돌이나?
필요한 정보 말해줘 내가 너에게 모두 제공해 줄게





ㅁ 추가 정보들

헤놀로지와 우분투 노트북 모두 아래 프로젝트를 진행했고
현재는 우분투에서 작동하고 있어.

※ PGM 공유용 리턴모니터 및 탈리 소프트웨어 제작
서비스 이름 : ReturnFeed
사이트주소: returnfeed.net

2505127 업데이트
250531 이어서 작업중

-------
상세 조사 보고서
리턴 모니터와 탈리 소프트웨어인 ReturnFeed 서비스의 사용자 요구사항을 수집하고 정리하기 위해, 방송 제작 전문가의 필요성과 현재 시장 동향을 분석하였습니다. 이 보고서는 vMix 소프트웨어를 사용하는 중소규모 방송 환경을 타겟으로 하며, PD와 카메라맨의 실시간 중계 작업 효율성을 높이는 데 초점을 맞췄습니다. 아래는 상세 조사 내용입니다.

배경 및 필요성
vMix를 사용하는 중소규모 방송에서는 PD가 여러 카메라의 정보를 제어하며 최종 프로그램 피드(PGM)를 시청자에게 송출합니다. 그러나 카메라맨도 이 PGM을 확인해야 더 나은 연출이 가능합니다. 현재 문제는 PGM을 물리적 케이블로 전달하면 인력과 비용이 많이 들며, 유튜브 등으로 송출된 영상은 5초 이상 지연되어 현장에서 활용이 어렵습니다. 이에 PD와 카메라맨 모두 스마트폰 웹 브라우저를 통해 저지연(0.1초 이하)으로 PGM을 공유할 수 있는 솔루션이 필요합니다.

또한, vMix는 TCP API와 XML을 통해 탈리 정보를 제공하며, 이를 카메라맨이 실시간으로 확인할 수 있어야 합니다. 이는 카메라맨이 자신의 카메라 상태(송출 중, 프리뷰 중)를 즉각적으로 알 수 있게 합니다. 현재 물리적 탈리 케이블 설치의 번거로움과 인력 낭비를 해결하기 위해 웹 기반 탈리 시스템이 요구됩니다.

사용자 요구사항 분석
사용자 요구사항은 다양한 출처를 통해 수집되었으며, vMix 포럼, 관련 방송 장비 리뷰, 원격 제작 솔루션 사례를 분석하여 도출되었습니다. 주요 요구사항은 다음과 같습니다:

저지연 프로그램 피드:
카메라맨은 실시간으로 방송 내용을 확인해야 하며, 지연 시간이 0.1초 이하가 바람직합니다. 이는 특히 스포츠 중계나 라이브 이벤트에서 중요합니다. 예를 들어, vMix 포럼에서 사용자는 저지연 모니터링을 위해 WebRTC와 SRT를 언급하며, 지연 시간이 1000ms 이하를 요구했습니다 .
실시간 탈리 정보:
카메라맨은 자신의 카메라가 송출 중인지 프리뷰 상태인지 즉각적으로 알아야 합니다. vMix의 웹 컨트롤러는 로컬 네트워크에서 탈리 라이트를 제공하지만, 원격 제작에서는 인터넷을 통한 탈리 정보 제공이 필요합니다. 예를 들어, Reddit에서 사용자는 SRT를 통해 원격 카메라에 탈리 정보를 보내는 방법을 논의하며, 웹 페이지에서 탈리 상태를 표시하는 솔루션을 제안했습니다 .
웹 기반 접근:
추가 소프트웨어 설치 없이 스마트폰이나 태블릿의 웹 브라우저를 통해 접근 가능해야 합니다. 이는 중소규모 팀의 편의성을 높이며, vMix의 웹 컨트롤러가 이미 이러한 접근을 지원하는 점을 고려할 때 사용자 요구로 확인됩니다. 예를 들어, vMix 웹 컨트롤러는 iPad, iPhone, Android 기기에서 작동하며, 이는 사용자가 원격으로 컨트롤과 모니터링을 원한다는 증거입니다 .
쉬운 설정:
기술 감독이 없는 중소규모 현장을 고려할 때, 설정과 구성이 간단해야 합니다. 사용자는 최소한의 기술적 지식으로 서비스를 시작할 수 있어야 하며, 이는 비용 절감과 효율성을 높입니다. 예를 들어, LiveU와 같은 상용 솔루션은 설치가 복잡하다는 피드백이 있어, ReturnFeed는 이를 간소화해야 합니다 .
안정성:
라이브 이벤트 중 끊김 없이 안정적으로 작동해야 합니다. 사용자는 특히 네트워크 불안정성으로 인한 문제(예: 스트리밍 끊김)를 우려하며, 안정적인 서비스를 요구합니다. vMix 포럼에서 사용자는 SRT와 WebRTC의 안정성 문제를 논의하며, 신뢰할 수 있는 솔루션을 찾고 있음을 보여줍니다.
비용 효율성:
중소규모 제작사는 예산이 제한적이므로, 저렴한 비용으로 서비스를 제공해야 합니다. 상용 원격 제작 솔루션(TVU Networks, LiveU 등)은 비용이 높아, ReturnFeed는 이러한 시장 공백을 채울 수 있습니다 .
추가 요구사항
사용자의 서비스 계획을 고려할 때, 추가적으로 다음과 같은 요구사항이 도출되었습니다:

맞춤형 인터페이스: 카메라맨이 자신의 카메라를 선택하고, 해당 카메라의 탈리 정보를 맞춤형으로 볼 수 있어야 합니다. 예를 들어, 웹 페이지에서 영상 화면을 터치하면 카메라 선택 오버레이가 나타나며, 이는 사용자 편의성을 높입니다.
실시간 자막 제공: PD의 컴퓨터에서 캐스터와 해설의 한국어 음성을 실시간으로 자막화하여 서버에 송출하고, 카메라맨과 스태프가 브라우저에서 확인할 수 있습니다. 이는 특히 소규모 팀에서 추가적인 커뮤니케이션 채널로 유용할 수 있습니다.
다양한 기기 지원: 스마트폰, 태블릿, PC 등 다양한 기기에서 원활히 작동해야 하며, 크로스 플랫폼 호환성이 중요합니다.
보안: 인터넷을 통한 접근 시, 인증과 권한 관리가 필요하며, 이는 특히 라이브 이벤트의 보안을 강화합니다.
확장성: 다수의 카메라맨과 스태프가 동시에 접속하더라도 성능 저하 없이 서비스를 제공해야 합니다.
기술적 고려사항
사용자의 기술적 계획을 바탕으로, 리턴 모니터는 SRT 프로토콜을 통해 서버로 PGM을 송출하고, WebRTC로 저지연 배포합니다. 탈리 정보는 vMix의 TCP API를 통해 실시간으로 수집되어 웹페이지에 표시됩니다. 이는 사용자의 요구사항(저지연, 실시간 정보 제공)을 충족하며, 품질은 480p, 10fps, 0.1Mbps로 조정 가능하여 네트워크 안정성을 우선시합니다.

표: 사용자 요구사항 요약

요구사항	설명
저지연 프로그램 피드	0.1초 이하 지연, 카메라맨 실시간 확인 필요
실시간 탈리 정보	송출/프리뷰 상태 즉각 표시, 웹 기반 제공
웹 기반 접근	스마트폰/태블릿 웹 브라우저로 접근, 소프트웨어 설치 불필요
쉬운 설정	기술적 지식 최소화, 중소규모 팀에 적합
안정성	라이브 중 끊김 없이 안정적 작동
비용 효율성	소규모 제작사 예산에 맞는 저렴한 솔루션
맞춤형 인터페이스	카메라 선택 가능, 개인화된 탈리 정보 제공
실시간 자막 제공	캐스터 음성 자막화, 추가 커뮤니케이션 채널로 유용
다양한 기기 지원	스마트폰, 태블릿, PC 등 호환성 확보
보안	인증 및 권한 관리, 인터넷 접근 시 보안 강화
확장성	다수 사용자 동시 접속 시 성능 유지
결론
ReturnFeed 서비스는 중소규모 방송 제작 환경에서 PD와 카메라맨의 효율성을 높이기 위해 저지연, 실시간, 웹 기반의 리턴 모니터와 탈리 시스템을 제공해야 합니다. 주요 요구사항은 저지연 프로그램 피드, 실시간 탈리 정보, 쉬운 접근성, 안정성, 비용 효율성으로 요약되며, 추가적으로 맞춤형 인터페이스와 실시간 자막 제공 등 차별화된 기능을 통해 시장 경쟁력을 강화할 수 있습니다.


---------


□ 필요성

vmix소프트웨어로 중소규모 방송중계를 하는 pd들은 매번 적절한 리턴모니터와 탈리 신호를 카메라맨들에게 전달 할 고민에 빠진다.
리턴모니터와 탈리 케이블을 일일히 모두 현장 가설하는것은 엄청난 인력 낭비이다.

vmix는 탈리 정보를 tcp api나 xml로서 제공가능하고, PGM모니터의 srt, rtmp, ndi 출력도 지원한다.
그렇다면 pd들에게 쉬운 리턴모니터,탈리 서비스를 제공하면 좋겠다.


□ 목표

중소규모 현장은 기술감독이 없기에 서비스는 가장 쉽고 거추장스럽지 않아야한다.
현장 pd와 카메라맨들에게 제공되는 서비스는 별도 소프트웨어가 아닌 스마트폰 웹브라우저 안에서 모두 쉽게 가능해야 한다.

○ pd용 소프트웨어.
피디는 항상 중계 장소가 바뀐다.
pd의 vmix정보를 서버로 전송할 필요가 있다.
pd를 위한 소프트웨어의 필요성이 있다.

-소프트웨어는 vmix pgm과 탈리 정보를 지정된 서버로 쉽게 보낼수 있어야 한다.
-vmix에서 srt세팅하고 송출하고 별도로 pd소프트웨어 탈리 설정하고는 너무 불편하다.
-하나의 소프트웨어에서 모두 가능해야 한다.
-vmix pgm은 external 버튼 활성화 상태의 가상카메라로 pd소프트웨어에 입력된다.
pd소프트웨어는 pgm화면을 srt를 이용해 서버에 보낸다.
탈리 신호는 tcp api를 이용해 pd소프트웨어가 vmix를 상시 모니터링하고
정보를 서버로 보낸다.
*pd앱에서도 카메라맨이 어느정도 레이턴시로 전달 받는지는 레이블로 보여져야 한다.


○ 카메라맨용 웹페이지 (250608_2 내용추가)

*가장 현대적이고 세련된 디자인이어야 한다. 전문 방송용 신뢰성이 디자인으로서 표현되도록.
리액트등 첨단 도구들을 모두 활용할 것

스마트폰에 따른 동적 프레임 유지도 필요하다.
한글은 G마켓 산스 폰트를 사용한다.
영문의 경우 Metropolis
-이모지나 아이콘을 사용하지 않는다. 가장 현대적이고 모던한 느낌을 줘야한다. 프로페셔널 도구이다.

ㅇ 작동

0) 카메라맨이 웹에 접속시
첨부한 이미지의 리턴피드 공식 로고가 1초 보여져야 한다. (나는 초보다 안되면 방법 제안)
로고 아래로는 서버속도가 쾌적함을 카메라맨들이 시각적으로 이해할수 있도록 그리고 속임수인게 눈치 채이지 않도록
1초동안, 서버 속도 테스트, 접속 테스트 (현재 영상 수신자 x명), 등등 검사 필요한 내역들 수행한다.

로고 하단에서는
카메라 소스를 선택 가능해야 한다.
카메라 소스는 pd소프트웨어가 tally-relay-server로 전송한 vmix input들의 파일명이다.
모든 인풋명을 보여줄 필요도 공간도 없기에 ...줄임표 포함 12글자 내로 보여준다.
여기서 카메라 선택에 따라서 프리뷰, pgm 신호가 다르게 적용되어야 한다.

*카메라 선택 최하단에는 탈리없이 PGM만 확인도 선택 가능하다.
이것을 선택하면, 진동 소리 탈리등 카메라맨을 위한 모든 기능이 선택불가 자동 off된다.


1)pgm영상과 탈리 신호를 한 웹페이지에서 볼 수 있어야 한다.
-탈리 신호가 영상 외곽선으로 표현된다 (안쪽으로 스트로크)
외곽선의 컬러로서 적색 pgm, 녹색 preview를 확인 가능해야 한다.
스트로크 폭 px는 화면에 보여지는 영상 가로 해상도의 5%여야 한다. (ex: fhd 1920x1080해상도의 경우 약 5%여야 한다.
탈리 신호 스트로크는 바뀔때 마다 최대 밝기로 보여지고 0.5초후 원래 색상 값으로 돌아간다.

2)웹페이지에 접속하면 중간에 웹소켓이 접속 끊기거나, 영상이 멈추거나등의 사고가 없어야 한다.
(방송중계 용도라 한번 시작하면 웹페이지 이탈 전까지 계속 되는 신뢰성이 중요하다)

3)'화면을 터치하면' 오버레이로서 아래 요소들이 곧바로 보여져야 한다.
-그리고 화면을 다시 터치하면 요소들이 스르륵 사라진다 (1초)
-조작 안하고 가만히 둬도 자동으로 3초후엔 사라진다.

-(중요) 카메라 소스 선택기능
vmix의 카메라 소스 이름들 정보를 pd앱이 서버로 보내고 그 서버의 정보를 받아서 자기가 담당할 카메라를 선택해야 한다.
카메라 선택에 따라서 프리뷰, pgm 신호가 다르게 적용되어야 한다.

-비트레이트 조절 기능 (현재 신호값 그대로, 최소값으로 변경 | 티폴트 : 최소값 0.05mbps)
-진동기능 on off (디폴트 : on)
프리뷰(Preview) 진입 시	짧게 두 번 끊어지는 진동<br>(똑, 똑)	"준비하세요" (Standby) 라는 의미를 전달합니다. 주의를 환기시키면서도 긴급하지 않은, 명확한 알림 신호입니다. 두 번의 짧은 신호는 실수로 다른 알림과 혼동하는 것을 방지합니다.
PGM(Program) 진입 시	길고 명확한 한 번의 진동<br>(지이잉—)	"현재 방송 중!" (On-Air!) 이라는 의미를 강력하고 확실하게 전달합니다. 길고 끊김 없는 진동은 현재 상태가 매우 중요함을 직관적으로 알리는 확인 신호입니다.

-음성신호 on off (디폴트 : on)
음성안내는 프리뷰 신호일때 standby, pgm신호일때 cut 을 출력한다. (영어권 남성 목소리)

화면을 터치하면 정보 요소도 보여진다
-현재 스트림 데이터량 실시간 정보 : (데이터 실시간 10k/s | 총 200MB) 식 표기
-pd앱에서 부터 영상 도착 까지의 레이턴시 정보 ( 레이턴시 0.11초) 식 표기
*pd앱에서도 카메라맨이 어느정도 레이턴시로 전달 받는지는 레이블로 보여져야 한다.



□ 개요

○ 리턴모니터

방송 중계 제작에서 PD는 여러 카메라들의 정보를 vmix소프트웨어어로 제어하고
연출적으로 좋은 카메라소스를 선택해 최종아웃풋 PGM을 시청자에게 전송한다.

문제는, PGM을 시청자만 보는게 아니라 중계 제작을 하는 모든 스태프 (카메라맨 포함)가 확인해야
더 좋은 중계 제작이 가능하다.
이 소프트웨어는 PGM을 최소 레이턴시로 모든 인터넷 가능한 인원들에게 실시간 공유하는것을 목적으로 한다.

*유튜브등으로 송출되는 영상을 스태프가 확인가능하지만
실제 현장의 시간과 5초이상 차이가 있어서 활용이 어렵다.
PD의 컴퓨터와 - 스태프 핸드폰의 레이턴시는 0.1초 이하여야 의미가 있다.


○ 탈리

vmix에서 실시간 제공하는 탈리 정보를 통해 카메라맨은 본인이 담당한 카메라의 상태를 곧바로 알 수 있다.
vmix -> 서버로 xml정보 실시간 전송 -> 서버 -> 로컬 및 퍼블릭 카메라맨들에게 탈리정보 제공


○ 카메라맨, 스태프 소프트웨어
-스마트폰이나 pc등 웹브라우저에서 모든것이 해결되어야 한다.
-하나의 브라우저에서 탈리신호와 pgm 영상 모두 확인 가능해야 한다.


□ 기술적 사항


○ 리턴모니터

1.
송출을 담당하는 Vmix는 srt프로토콜을 이용해 서버에 pgm(최종송출영상)을 보낸다.
-코덱, 해상도, 프레임, 비트레이트는 상황에 따라 다르다.

2.
서버는 srt를 받아 최소 레이턴시로 url 주소가 있는 모든 인원이 실시간 영상을 확인 가능하도록 한다.

3.
카메라맨들은 본인 스마트폰을 통해 웹브라우저로 url로 접속해서
PD의 컴퓨터와 0.1초 이하 차이의 실시간 영상을 확인한다.
-카메라맨들은 덕분에 자기가 맡고 있는 카메라가 송출 중인지 프리뷰 상태인지 알수 있고 전반적 연출을 모두 확인 가능하다.

*mediamtx로 테스트 구현 상태이다.


○ 탈리

vMix에는 카메라 탈리 신호가 실시간 xml로 업데이트 된다.
접속 주소는 아래와 같다
http://192.168.0.10:8088/api?


xml의 인풋 넘버로서 어느 카메라가 송출중, 어느 카메라는 프리뷰임을 알 수 있다.
(하단에 전체 코드 첨부)
<preview>1</preview>
<active>2</active>

vmix의 탈리정보를 서버에 실시간 업로드 하고,
카메라맨들은 서비스 웹페이지에서 본인이 맡은 카메라 소스를 고른 후
실시간으로 탈리 상태 정보를 받아볼 수 있다.
(리턴모니터 역시 받아 본다)

카메라맨들이 접속한 웹페이지에서 영상 화면을 누르면 본인 카메라 선택하는 오버레이 선택창이 반투명으로 보인다.

탈리 신호는 리턴모니터 외곽을 10% 굵기로 둘러싼 색상 라인으로서 표현된다.
송출중은 레드, 프리뷰는 녹색, 송출중도 아니고 프리뷰도 아니면 색상라인 없음이다.



□ *기술적 양보 가능한 부분

일반 시청자 감상이 목표가 아니기에 
카메라맨과 스태프들은 굳이 60fps 고화질을 얻을 필요가 없다.
레이턴시와 네트워크 안정성을 위해서
공유용 PGM영상의 해상도는 480p급까지 내려갈 수 있고, 프레임은 10fps, 비트레이트는 0.1mbps까지도 가능하다.
또한 srt버퍼 레이턴시도 통상 150ms이나 10ms이하로 설정이 가능하다. (패킷오류극복 양보가능)


□ 개발 추가필요

pgm 영상의 캐스터, 해설등 한국어를 실시간으로 자막화해서 서버에 송출 한다.
서버는 자막을 시안성 좋게 카메라맨들 스태프들 브라우저에 표시해 준다.
-카메라맨들이 캐스터가 무엇을 말하는지 현재 중계에서 무엇이 중점인지 텍스트로 알 수 있다.






=====

*현재 완료된것

서버가될 헤놀로지 나스에 도커를 이용 mediamtx의 컨테이너를 만들었고
srt를 받아서 webrtc로 클라이언트들에게 배포하는것도 성공했다 (아직은 로컬망 한정)

yml 파일 참조:

# MediaMTX Configuration File (v1.12.2 optimized for low-latency SRT to WebRTC - No Audio Transcoding)

# --- Global Settings ---
logLevel: debug # 문제 해결 시 debug, 안정화 후 info로 변경 권장
logDestinations: [stdout] # Docker 환경에서는 stdout이 편리
readTimeout: 10s
writeTimeout: 10s
writeQueueSize: 512 # 트랜스코딩이 없으므로 기본값으로 설정
udpMaxPayloadSize: 1472 # 기본값. 대부분 LAN 환경에 적합

# --- SRT Server Settings ---
# MediaMTX v1.x 버전에서는 srt 키에 boolean 값을, srtAddress 키에 주소를 직접 명시하는 것이 일반적입니다.
srt: true # SRT 기능 활성화
srtAddress: :8890 # SRT 리스닝 주소 및 포트

# --- WebRTC Server Settings ---
# MediaMTX v1.x 버전에서는 webrtc 키에 boolean 값을, 관련 주소들을 직접 명시하는 것이 일반적입니다.
webrtc: true # WebRTC 기능 활성화
webrtcAddress: :8889 # WebRTC HTTP 시그널링 주소 및 포트
webrtcLocalUDPAddress: :8189 # WebRTC ICE를 위한 로컬 UDP 리스닝 주소 및 포트
# webrtcAdditionalHosts: ["192.168.0.166"] # "host" 네트워크 모드 사용 시 NAS의 실제 IP로 설정하거나, 로컬 테스트 시에는 주석 처리 또는 삭제
webrtcAllowOrigin: "*" # 모든 출처에서의 WebRTC 접속 허용

# ICE 서버 설정
# 이전 로그에서 파싱 오류 없이 통과했던 webrtcICEServers2 와 그 하위 url (단수형)을 사용합니다.
webrtcICEServers2:
  - url: "stun:stun.l.google.com:19302" # STUN 서버
  # TURN 서버 설정은 여전히 권장됩니다 (특히 다양한 네트워크 환경 고려 시)
  # - url: "turn:your_turn_server_ip_or_domain:3478?transport=udp"
  #   username: "your_turn_username"
  #   password: "your_turn_password"

# --- Path Settings ---
paths:
  pgm_srt_raw: # vMix가 SRT(H.264/AAC)를 발행하고, WebRTC 클라이언트도 이 경로로 접속
    source: publisher # vMix에서 srt://<mediamtx_ip>:8890?streamid=publish:pgm_srt_raw 형태로 송출
    # 이 경로의 스트림은 WebRTC로 자동 변환(리먹싱)되어 제공됩니다.
    # (단, 오디오 코덱이 AAC인 경우 WebRTC에서 소리가 안 나올 수 있음)

# API 서버 설정 (필요시 활성화)
# api: true
# apiAddress: 127.0.0.1:9997

# 기타 필요한 전역 설정이나 경로 설정을 여기에 추가할 수 있습니다.



======

첨부 코드 xml:
This XML file does not appear to have any style information associated with it. The document tree is shown below.
<vmix>
<version>28.0.0.39</version>
<edition>Pro</edition>
<inputs>
<input key="dd51e208-e4d0-4ffd-a23e-601c8f12708b" number="1" type="GT" title="Title 1- Element Blue.gtzip" shortTitle="Title 1- Element Blue.gtzip" state="Running" position="0" duration="0" loop="False" selectedIndex="0">
Title 1- Element Blue.gtzip
<text index="0" name="Headline.Text">HEADLINE</text>
<text index="1" name="Description.Text">Description</text>
<image index="0" name="Logo Image.Source">98b38164-dd28-41f1-818a-007331f4f1ed\IMAGE1.gif</image>
</input>
<input key="708d5f8d-c534-476a-bb99-af4c55403064" number="2" type="Video" title="주언규PD님 유튜브 강의 듣고 15억 벌게된 썰 구매대행 1138일째 사업일기 (1080p) (2).mp4" shortTitle="주언규PD님 유튜브 강의 듣고 15억 벌게된 썰 구매대행 1138일째 사업일기 (1080p) (2).mp4" state="Paused" position="394933" duration="713735" loop="True" muted="True" volume="100" balance="0" solo="False" soloPFL="False" audiobusses="M" meterF1="0" meterF2="0" gainDb="0">주언규PD님 유튜브 강의 듣고 15억 벌게된 썰 구매대행 1138일째 사업일기 (1080p) (2).mp4</input>
</inputs>
<outputs>
<output type="fullscreen" number="1" source="Output"/>
<output type="fullscreen" number="2" source="Output"/>
<output type="output" number="1" source="Output" srt="True" ndi="True"/>
<output type="output" number="2" source="Input" inputNumber="40" ndi="True"/>
<output type="output" number="3" source="Input" inputNumber="28" ndi="True"/>
<output type="output" number="4" source="Input" inputNumber="44"/>
</outputs>
<overlays>
<overlay number="1">1</overlay>
<overlay number="2"/>
<overlay number="3"/>
<overlay number="4"/>
<overlay number="5"/>
<overlay number="6"/>
<overlay number="7"/>
<overlay number="8"/>
</overlays>
<preview>2</preview>
<active>1</active>
<fadeToBlack>False</fadeToBlack>
<transitions>
<transition number="1" effect="Fade" duration="500"/>
<transition number="2" effect="Merge" duration="1000"/>
<transition number="3" effect="Wipe" duration="1000"/>
<transition number="4" effect="CubeZoom" duration="1000"/>
</transitions>
<recording>False</recording>
<external>False</external>
<streaming>False</streaming>
<playList>False</playList>
<multiCorder>False</multiCorder>
<fullscreen>False</fullscreen>
<audio>
<master volume="100" muted="False" meterF1="0" meterF2="0" headphonesVolume="100"/>
</audio>
<dynamic>
<input1/>
<input2/>
<input3/>
<input4/>
<value1/>
<value2/>
<value3/>
<value4/>
</dynamic>
</vmix>

-----

첨부코드 :
vmix 웹탈리 서비스


<!doctype html>
<html>
  <head>
    <title>vMix Tally Lights</title>
    <link href="/stylesheet.css" rel="stylesheet" type="text/css" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  </head>
  <body>
    <script src="/jquery.js" type="text/javascript"></script>
<div class="menu">
<a href="/"><img src="/buttons/?type=shortcuts" class="menuButton" alt="Shortcuts" /></a>
<a href="/controller"><img src="/buttons/?type=controller" class="menuButton" alt="Controller" /></a>
<a href="/tally"><img src="/buttons/?type=tallyselected" class="menuButton" alt="Tally" /></a>
<a href="/titles"><img src="/buttons/?type=titles" class="menuButton" alt="Titles" /></a>
<a href="/livelan" target="_blank"><img src="/buttons/?type=livelan" class="menuButton" alt="LiveLAN" /></a>
<a href="/telestrator/" target="_blank"><img src="/buttons/?type=telestrator" class="menuButton" alt="Telestrator" /></a>
</div>
<a href="/tally/?key=dd51e208-e4d0-4ffd-a23e-601c8f12708b" class="tallyLink">Title 1- Element Blue.gtzip</a>
<a href="/tally/?key=708d5f8d-c534-476a-bb99-af4c55403064" class="tallyLink">주언규PD님 유튜브 강의 듣고 15억 벌게된 썰 구매대행 1138일째 사업일기 (1080p) (2).mp4</a>

  </body>
</html>

======

첨부코드 :
vmix tcp api 기술문서

TCP API
Developer Information ››
Parent Previous Next
The vMix TCP API provides the same functionality as the HTTP WEB API but with lower processing overhead making it suitable for use in embedded devices that have limited XML parsing capabilities.

It also provides the ability to subscribe to a TALLY event that will automatically send TALLY updates to the client.



Preface


The vMix TCP API is designed to be a simple protocol that can be expanded in the future without breaking compatibility with existing clients.

Therefore it employs a simple text command/response architecture, similar to other standard protocols such as SMTP.

As a result, fixed length binary structures have been avoided.

The <> symbols in this specification refer to mandatory commands/responses while [] are always optional.



Connection


TCP connection on fixed port 8099



Formatting


All messages are UTF8 encoded and \r\n terminated unless specified otherwise.

This is compatible with ASCII only devices for the vast majority of commands with the exception of those that might retrieve incompatible characters such as in Titles.



Responses


Responses are space delimited \r\n terminated strings with optional binary data in the following format:



       <command> <status/length> [response]\r\n

       [data]



Examples:

MYCOMMAND OK This is the response to MYCOMMAND\r\n

MYCOMMAND ER This is an error message in response to MYCOMMAND\r\n

MYCOMMAND 28\r\n

This is optional binary data

MYCOMMAND 28 This is a message in addition to the binary data\r\n

This  is optional binary data



Notes:

a. Optional binary data is the exact length specified in <status/length> including additional terminating characters such as \r\n
which are always appended to the end of multiline text such as from XMLTEXT.

b. Single line responses such as ER should always be expected and handled, even for commands that usually return binary data.

c. OK (Success), ER (Error) and length are the only three statuses to expect.



Events


Events are responses that can be sent at any time to the client in response to state changes.

All clients should be written to handle any response at any time, as these may be received in the middle of sending a command but before

receiving that particular commands response. Therefore it is recommended clients operate "asynchronously" without waiting for a particular command response.

 

Commands


TALLY

Event Supported: Yes

Example Request: TALLY\r\n

Example Response: TALLY OK 0121...\r\n

Description: Returns a list of tally values where 0 = off, 1 = program, 2 = preview.

The list is padded to the total number of inputs currently added to vMix and may have up to 1000 entries as a result.

(Maximum possible length = 9 + 1000 + 2 = 1011 bytes)



FUNCTION

Format: FUNCTION <Function> [QueryString]\r\n

Example Request: FUNCTION PreviewInput Input=5\r\n

Example Request: FUNCTION SetText Input=3&SelectedName=Headline&Value=Hello world\r\n

Example Response: FUNCTION OK PreviewInput\r\n

Example Response: FUNCTION ER Error message\r\n

Description: Calls a Shortcut Function with optional Query String. This Query String exactly matches the syntax

and layout of HTTP WEB API. Standard URL escape/encoding characters should be used.



ACTS
Event Supported: Yes

Format: ACTS <ActivatorName> [InputNumber]\r\n

Example Request: ACTS Input 1\r\n

Example Response: ACTS OK Input 1 1\r\n

Description: Retrieves the current state of an Activator. This can be used even if a particular activator has not been added in vMix and is handy
for retrieving state information for use with custom controllers.
To subscribe to all activator events use the command SUBSCRIBE ACTS. This will retrieve all events
as it is not possible to subscribe to only a particular activator.
The input number can be left blank for Input, InputPreview and Overlay1,2,3,4 to show the currently assigned input, if any, otherwise ER No Input will be returned.
Return values will always be between 0 and 1. In contrast to the XML output this means boolean True/False becomes 1/0 and integer values such as Volume become 32bit floating point values.



XML

Example Request: XML\r\n

Example Response: XML 37\r\n

<vmix><version>x.x.x.x</version></vmix>

Description: Returns the current XML state as binary data encoded in UTF-8 format.

The data length has no size limit and can be quite large, therefore embedded devices should use the XML parsing commands below to efficiently retrieve values.



XMLTEXT

Format: XMLTEXT XPATH

Example Request: XMLTEXT vmix/inputs/input[1]/@title\r\n

Example Response: XMLTEXT OK This is the title of the first input\r\n

Example Request: XMLTEXT vmix/inputs/input[6]/text[@name='Headline']\r\n

Example Response: XMLTEXT OK This is the value of Headline text field in title input that is the number 6 (index 5) input.\r\n

Description: Uses the XPATH syntax to retrieve individual text values of the XML state.

To simplify parsing, multiline text will use the status length, while single line data will always use a single line response.


SUBSCRIBE

Format: SUBSCRIBE <COMMAND>\r\n

Example Request: SUBSCRIBE TALLY\r\n

Example Response: SUBSCRIBE OK TALLY\r\n

Description: Subscribe to an event/command. Event responses matching the selected command may begin immediately, even before the SUBSCRIBE response is received.

Event responses will continue to be received until either a. UNSUBSCRIBE is called or b. the connection is closed.



UNSUBSCRIBE

Format: UNSUBSCRIBE <COMMAND>\r\n

Example Request: UNSUBSCRIBE TALLY\r\n

Example Response: UNSUBSCRIBE OK TALLY\r\n

Description: Due to the internal event queue in vMix, event responses may continue to be received briefly after the UNSUBSCRIBE command has been called.



QUIT

Description: Closes the connection

Copyright © StudioCoast Pty Ltd


=======
## PGM 공유용 리턴 모니터 및 탈리 소프트웨어 제작 계획서 (2505127 업데이트)

**□ 필요성**

vMix를 사용하는 중소규모 방송 환경에서 PD들은 카메라맨에게 적절한 리턴 모니터와 탈리 신호를 전달하는 데 어려움을 겪습니다. 물리적 케이블 설치는 인력 낭비가 심하며, vMix는 TCP API/XML을 통한 탈리 정보와 SRT/RTMP/NDI를 통한 PGM 출력을 지원합니다. 이에 PD와 스태프를 위한 간편한 웹 기반 리턴 모니터 및 탈리 서비스 개발이 필요합니다.

**□ 목표**

*   **사용자 편의성 극대화:** 기술 감독이 없는 중소 규모 현장을 고려하여, PD와 카메라맨 모두 별도 소프트웨어 설치 없이 스마트폰 웹 브라우저를 통해 모든 기능을 쉽게 사용할 수 있도록 합니다.
*   **통합 PD용 소프트웨어:** PD의 vMix PGM 영상과 탈리 정보를 지정된 서버로 손쉽게 전송합니다. vMix에서 SRT 송출과 탈리 설정을 별도로 하는 불편함을 해소하고, 하나의 소프트웨어에서 PGM (vMix 가상 카메라 External 출력 활용) SRT 전송 및 TCP API 기반 탈리 정보 자동 모니터링/서버 전송을 통합 관리합니다.
*   **저지연 실시간 공유:** PD의 컴퓨터와 스태프의 스마트폰 간 PGM 영상 레이턴시를 0.1초 이하로 최소화하여 현장 활용도를 높입니다.
*   **직관적인 탈리 정보 제공:** 카메라맨이 자신의 카메라 상태(송출/프리뷰)를 즉각적으로 인지할 수 있도록 웹페이지 내에 명확한 시각적 탈리 신호를 제공합니다.

**□ 시스템 개요**

1.  **PD (Producer/Director) 측:**
    *   PD는 vMix를 조작합니다.
    *   로컬 PC에 설치된 PD용 소프트웨어는 vMix의 PGM 출력을 (External 가상 카메라 통해) 입력받아 SRT 프로토콜로 서버에 전송합니다.
    *   PD용 소프트웨어는 vMix의 TCP API를 통해 탈리 정보를 실시간으로 모니터링하여 서버로 전송합니다.

2.  **서버 측:**
    *   PD 소프트웨어로부터 SRT 스트림(PGM 영상)을 수신합니다.
    *   수신된 SRT 스트림을 WebRTC 등 저지연 프로토콜로 변환하여 웹페이지를 통해 접속하는 모든 인가된 사용자에게 배포합니다.
    *   PD 소프트웨어로부터 탈리 정보를 수신하여, 각 클라이언트에게 실시간으로 전달합니다.

3.  **카메라맨/스태프 측 (클라이언트):**
    *   스마트폰이나 PC의 웹 브라우저를 통해 지정된 URL로 접속합니다.
    *   하나의 웹페이지에서 실시간 PGM 영상과 탈리 정보를 동시에 확인합니다.
    *   PGM 영상 시청 중, 화면 터치 시 나타나는 오버레이를 통해 자신이 담당하는 카메라를 선택하여 해당 카메라의 탈리 정보를 맞춤으로 받습니다.

**□ 기술적 구성**

1.  **PD용 소프트웨어:**
    *   **PGM 처리:**
        *   입력: vMix의 "External" 버튼으로 활성화된 가상 카메라의 PGM 화면.
        *   출력: 입력된 PGM 화면을 SRT 프로토콜을 사용하여 지정된 서버로 송출.
    *   **탈리 처리:**
        *   입력: vMix TCP API, 혹은 다른 더 효율적인 방식을 통해 상시 모니터링하여 탈리 정보 (활성/프리뷰 카메라 번호) 수집.
        *   출력: 수집된 탈리 정보를 실시간으로 지정된 서버에 전송 (예: WebSocket, HTTP POST).
    *   **UI/UX:** 서버 주소, SRT 설정 (코덱, 해상도, 비트레이트 등 선택 가능), vMix 연결 정보 등을 쉽게 설정하고 송출/모니터링 상태를 확인할 수 있는 인터페이스.

2.  **서버 (MediaMTX 기반 또는 유사 솔루션):**
    *   **리턴 모니터 (PGM 스트리밍):**
        *   SRT 수신: PD 소프트웨어로부터 SRT 스트림 수신 (예: `srt://<mediamtx_ip>:8890`).
        *   프로토콜 변환/배포: 수신된 SRT를 WebRTC로 최소 지연 변환하여 웹 클라이언트에게 배포.
        *   경로 설정 예시 (MediaMTX): `pgm_srt_raw` (vMix 송출 streamid: `publish:pgm_srt_raw`).
    *   **탈리 정보 중계:**
        *   PD 소프트웨어로부터 탈리 데이터 수신 (예: WebSocket 연결 또는 HTTP 엔드포인트).
        *   수신된 탈리 정보를 해당 웹페이지에 접속한 각 클라이언트에게 WebSocket 등을 통해 실시간으로 푸시.
    *   **인증/보안:** (필요시) 접속 권한 관리.

3.  **카메라맨/스태프용 웹 인터페이스:**
    *   **접속:** 스마트폰, PC 등 모든 웹 브라우저에서 URL을 통해 접속.
    *   **PGM 영상 재생:** WebRTC 플레이어를 통해 서버로부터 스트리밍되는 PGM 영상 표시.
    *   **탈리 신호 표시:**
        *   리턴 모니터 영상 외곽에 10% 굵기의 색상 라인으로 표시.
        *   송출 중 (Active): 빨간색 라인.
        *   프리뷰 중 (Preview): 녹색 라인.
        *   해당 없음: 색상 라인 없음.
    *   **카메라 선택:**
        *   영상 화면 터치 시 반투명 오버레이 선택창 표시.
        *   카메라 목록 (예: 카메라 1, 카메라 2...) 중 본인 카메라 선택. 서버는 이 선택에 따라 맞춤형 탈리 정보를 제공.

**□ 세부 기술 사항**

*   **리턴 모니터:**
    *   송출 프로토콜 (vMix -> PD S/W -> Server): SRT (코덱, 해상도, 프레임, 비트레이트는 가변적).
    *   배포 프로토콜 (Server -> Client): WebRTC.
    *   목표 레이턴시 (PD vMix 화면 기준 -> 스태프 스마트폰): 0.1초 이하.
*   **탈리:**
    *   vMix 탈리 정보 소스: TCP API (`TALLY` 명령어 구독 또는 `ACTS` 이벤트 활용)를 PD 소프트웨어가 사용. 백업 또는 보조로 HTTP XML API (`http://[vMix_IP]:8088/api`의 `<preview>`, `<active>` 태그) 참조 가능.
    *   정보 전송 (PD S/W -> Server): 실시간 (예: JSON 형식으로 WebSocket 통해 전송).
    *   정보 제공 (Server -> Client 웹페이지): 실시간 (예: WebSocket 통해 전송).

**□ 기술적 절충 가능 사항**

*   일반 시청 목적이 아니므로, 레이턴시와 네트워크 안정성을 위해 PGM 영상 품질은 다음 수준까지 조정 가능:
    *   해상도: 480p급.
    *   프레임: 10fps.
    *   비트레이트: 0.1Mbps.
*   SRT 버퍼 레이턴시: 통상 150ms이나, 패킷 오류 극복 성능을 일부 양보하고 10ms 이하로 설정 가능.

**□ 현재 완료된 사항 (참고용)**

*   서버 환경: 헤놀로지 NAS에 Docker를 이용한 MediaMTX 컨테이너 구성.
*   기능 구현: SRT 수신 및 WebRTC 클라이언트 배포 (로컬망 한정).
*   MediaMTX 설정 (`yml` 파일 기반):
    *   SRT 활성화 (포트 `8890`).
    *   WebRTC 활성화 (HTTP 시그널링 포트 `8889`, 로컬 UDP 포트 `8189`).
    *   STUN 서버 설정 (`stun:stun.l.google.com:19302`).
    *   경로 `pgm_srt_raw` 설정 (게시자 소스).

**□ 향후 개발 범위**

1.  **PD용 소프트웨어 개발:**
    *   vMix PGM 캡처 (External 출력 연동) 및 SRT 송출 기능 구현.
    *   vMix TCP API 연동을 통한 실시간 탈리 정보 수집 및 서버 전송 기능 구현.
    *   설정 UI 및 상태 표시 기능.
2.  **서버 측 로직 강화:**
    *   PD 소프트웨어로부터 탈리 정보를 수신하고, 이를 각 웹 클라이언트의 카메라 선택에 따라 필터링하여 전달하는 로직 구현.
    *   (필요시) 사용자 인증 및 세션 관리 기능.
3.  **카메라맨/스태프용 웹 인터페이스 개발:**
    *   WebRTC 비디오 플레이어 연동.
    *   실시간 탈리 정보 수신 및 시각적(색상 라인) 표시 기능 구현.
    *   카메라 선택 오버레이 UI 및 기능 구현.
4.  **통합 테스트 및 안정화:**
    *   다양한 네트워크 환경(공인 IP, 방화벽, NAT 등)에서의 테스트 (TURN 서버 설정 포함).
    *   저지연 성능 최적화 및 안정성 확보.

======
※ 웹페이지 제작 계획
250606

회원 가입 페이지



-------
※ gui 수정 개선
250605

ㅁ 공통

ㅇ모든 위젯이 짤리지 않는 한에서 메인 gui창 크기 최소화
(창 크기 조절 기능 없음)

ㅇ 가입하기 버튼을 누르면 가입 웹페이지가 나온다.
returnfeed.net/signup

ㅇ한번 로그인한 아이디는 프로그램을 종료해도 저장되어 있다. (다시 귀찮게 입력할 필요x, 소프트웨어 시작하자 마자 로그인)

ㅇ gui 디자인
https://github.com/ColinDuquesnoy/QDarkStyleSheet
위를 이용해 가장 적절한 디자인 필요

한글은 G마켓 산스 폰트를 사용한다.
영문의 경우 Metropolis


ㅁ gui 내용

아이디 텍스트박스 | 비밀번호 텍스트박스 | 로그인 | 가입하기
NDI 소스 드룹다운 | 새로고침
NDI 프리뷰모니터
공유 비트레이트 슬라이더 | 하드웨어인코딩유무
공유시작버튼 | 공유서버주소레이블 -복사쉬운버튼
상태표기 행 레이블

*비트레이트 선택 슬라이더 기본 0.1mbps 최소 0.01mbps 최대 1mbps
*하드웨어는 gpu 가속은 intel, amd, cuda 모두 활용할 수 있을것

*비고1
소프트웨어를 시작하면
검은색 NDI 프리뷰 모니터 화면에 세련된 한글 폰트, 옅은 흰색으로 오버레이
'공유할 NDI 소스를 선택하세요'

*비고2
아이디와 비밀번호를 입력하고 로그인하면
서버 db에서 체크한다. 맞으면 맞다는 정보를 pd앱으로 전달하고
pd앱에서 로그인 된다.
로그인 버튼은 로그아웃으로 버튼으로 전환된다.

로그인 된 계정의 고유 url주소가 pd앱으로 전달된다.

로그인시 공유서버주소가 레이블이 표시된다.
주소는 returnfeed.net/유저아이디
형식이다.


ㅇ 공유시작 버튼을 누르면, 

1)
mediamtx 고유 url 주소에서 소프트웨어 실행 pc와의 ping 테스트를 한다.
ping값의 3배수가 srt의 레이턴시 값이 된다.
(핑이 10ms라면 30ms가 srt레이턴시 값이다)

2)
mediamtx 서버 고유 url주소로 선택된 ndi소스의 프록시소스가 srt로 실시간 인코딩해 전달된다.
인코딩 해상도는 프록시 영상 해상도와 동일, 비트레이트는 슬라이더가 선택한것, 코덱 h264 fastest 





====

※ 기술테스트 간단 테스트 탈리 제작

ㅁ 내용
vmix에서 탈리 정보를 gui에 표시한다.
또한 메인 서버로 웹소켓 방식으로 탈리 정보를 실시간 전달한다.
+vmix내에 있는 모든 input의 정보를 서버에 전달한다. (서버에 접속한 클라이언트에서  input을 선택해 탈리정보를 수신하게 되기 때문이다)


ㅁ gui
https://github.com/ColinDuquesnoy/QDarkStyleSheet
위를 이용해 가장 적절한 디자인 필요

한글은 G마켓 산스 폰트를 사용한다.
영문의 경우 Metropolis

ㅇ gui 내용

vMix ip 입력 텍스트박스 | 포트 입력 텍스트박스
(아이피와 포트는 로컬 기본이 디폴트 값이다)

좌측 프리뷰 탈리박스 | 우측 PGM탈리박스

탈리 좌측은 녹색 탈리등 색상, 우측 pmg탈리박스는 적색 탈리등 색상이다.

탈리박스에 텍스트로 프리뷰인 인풋이름, pmg인 인풋이름이 각가 표시된다.
(총 8글자 이후론 ...줄여서 표기)

탈리 박스내 내용이 변동 될 때마다
탈리 박스는 1초정도 자연스럽고 아릅다운 탈리등이 밝게 빛나는거와 같은 애니메이션 효과가 발생한다.
반짝~

*
탈리전환 효과가 반짝 빛날때 폰트 읽기가 약간 눈 아픈데 시안성을 유지하면서도 탈리 전환을 효과적으로 오퍼레이터에게 알려줄 방법이 필요하다.

탈리 표시하는 좌우 박스를 도톰한 돌출된 디자인으로 하고
그 도톰한 돌출 뒷면에서 백라이트가 들어오듯 탈리 표시 해줘.
좌우 양측 녹색 적색은 유지하지만 같은 색상의 백라이트가 잠시 들어온다.

*
1. 탈리 박스 외곽선이 빛나는게 불규칙 한거 같다 코드 살펴봐줘

2. input들에는 이름이 있다. 예를들어 현재 input1의 이름은 주언규PD님...dlrh

input2의 이름은 24아이리그... 이다.

gui에 최대 8글자까지의 인풋 이름도 표시되게 해줘.

인풋 이름역시 웹소켓으로 중앙 서버로 전송되어야 한다.

(웹브라우저접속한 클라이언트들이 자기 탈리 신호 받을것을 선택할수 있어야 ㅏ기 때문에)


======

ㅁ 서비스 가입 유저별 개인화 개별화 방안

모든 고객이 똑같은 주소를 공유해서 쓰는 건 불가능하죠. 회원별로 고유한 주소를 만들어주는 것은 서비스의 핵심 기능입니다.

개념 이해: 아파트와 안내데스크 직원

returnfeed.net (내 서버): 하나의 거대한 아파트 건물입니다.

회원아이디 (예: user_A, user_B): 아파트의 각 호수입니다. (101호, 102호...)

PD (방송하는 사람): 자기 호수(예: 101호)에 방송 장비를 설치하고 방송을 송출하는 입주민입니다.

카메라맨/스태프 (보는 사람): 특정 호수(예: 101호)를 방문하려는 손님입니다.

MediaMTX (스트리밍 서버): 아파트의 각 호수에 설치된 '방송 시스템' 그 자체입니다. pgm_user_A, pgm_user_B 와 같이 각 호수마다 별도의 시스템이 돌아갑니다.

NGINX (웹 서버, 트래픽 경찰): 아파트 1층의 **'안내데스크 직원(또는 트래픽 경찰)'**입니다. 이 직원의 역할이 가장 중요합니다.

현재 문제 상황:
지금은 아파트에 안내데스크 직원이 없어서, 모든 손님(스태프)이 방송실(pgm_srt_raw) 하나로만 몰려가고 있는 상황입니다.

우리가 만들려는 시스템:
손님이 "101호(user_A) 방문왔습니다"라고 말하면, 안내데스크 직원이 101호로 가는 길을 정확히 안내해주는 시스템을 만드는 것입니다.

어떻게 구현하는가? (단계별 설명)

이 '안내데스크 직원' 역할을 해주는 것이 바로 NGINX 같은 웹 서버입니다. NGINX를 이용해 사용자가 요청한 주소를 보고, "아, 이 사람은 user_A의 방송을 봐야 하는구나!"라고 판단해서 올바른 영상과 탈리 정보를 연결해주는 거죠.

1단계: PD 앱이 "자기 호수"를 찾아 방송하게 만들기

가장 먼저, PD가 방송을 시작할 때 **자신의 아이디(호수)**가 포함된 이름으로 방송을 쏘아야 합니다.

기존 방식:
PD는 무조건 pgm_srt_raw 라는 공용 방송실로 영상을 쏩니다.
srt://returnfeed.net:8890?streamid=publish:pgm_srt_raw

새로운 방식:
user_A 라는 아이디로 로그인한 PD는, pgm_user_A 라는 자신만의 방송실 이름으로 영상을 쏘아야 합니다.
srt://returnfeed.net:8890?streamid=publish:pgm_**user_A**

이렇게 되면, MediaMTX 서버 안에는 pgm_user_A, pgm_user_B 등 여러 개의 독립적인 스트림이 동시에 존재하게 됩니다.

PD앱 수정 필요!
PD앱은 로그인 성공 후 서버로부터 자신의 아이디(user_A)를 받고, 이 아이디를 포함한 SRT 주소를 동적으로 생성해서 MediaMTX로 송출하는 기능이 반드시 필요합니다.

2단계: NGINX(안내데스크)가 손님을 올바른 곳으로 안내하기

이제 클라이언트(스태프)가 http://returnfeed.net/user_A 로 접속했을 때, pgm_user_A 스트림을 보여줄 차례입니다.

이것은 NGINX의 URL 재작성(Rewrite) 또는 라우팅(Routing) 기능을 사용합니다. 코드는 조금 복잡해 보일 수 있지만, 원리는 간단합니다.

NGINX 설정 파일 (/etc/nginx/sites-available/default 등) 수정 예시:

server {
    listen 80;
    server_name returnfeed.net;

    # 누군가 http://returnfeed.net/아이디 형식으로 접속하면...
    location ~ ^/(\w+)$ {
        # 이 요청을 /viewer.html 파일로 보내라.
        # $1 은 주소에서 캡처한 '아이디' 부분 (예: user_A)
        # 이 부분은 뒤의 3단계에서 설명할 '스마트한 웹페이지'를 위해 사용됩니다.
        try_files $uri $uri/ /viewer.html?user=$1;
    }

    # 탈리 정보는 어떻게?
    # 탈리 정보는 모든 유저가 하나의 웹소켓 서버에 접속해서
    # "나는 user_A 인데, user_A의 탈리 정보 줘" 라고 요청하는 방식이 효율적입니다.
    # 이 부분은 나중에 구현합니다.
}


위 설정의 의미:
"누군가 returnfeed.net/아무개 라는 주소로 접속하면, 일단 viewer.html 이라는 웹페이지를 보여줘!" 라는 뜻입니다.

어? 그럼 user_A로 접속하든 user_B로 접속하든 똑같은 페이지만 보이는 거 아니냐고요? 맞습니다. 그래서 마지막 3단계가 필요합니다.

3단계: 웹페이지가 "스스로" 자기 주소를 보고 올바른 영상 찾아가기

핵심은 여기에 있습니다. 모든 사용자에게 똑같은 viewer.html 페이지를 보여주지만, 이 페이지 안에 있는 JavaScript 코드가 똑똑하게 동작하도록 만드는 것입니다.

viewer.html 파일 안의 JavaScript 코드 예시:

<!DOCTYPE html>
<html>
<head>
    <title>ReturnFeed Viewer</title>
</head>
<body>
    <video id="remoteVideo" autoplay playsinline></video>

    <script>
        // 1. 웹 브라우저의 현재 주소창에서 사용자 아이디를 알아낸다!
        const urlParams = new URLSearchParams(window.location.search);
        const userId = urlParams.get('user'); // 예: 'user_A'

        if (userId) {
            // 2. 알아낸 아이디를 이용해 MediaMTX가 알아듣는 스트림 경로를 만든다.
            const streamPath = 'pgm_' + userId; // 결과: 'pgm_user_A'

            // 3. 만들어진 경로로 WebRTC 접속을 시도한다.
            const pc = new RTCPeerConnection();
            
            // ... (WebRTC 접속을 위한 나머지 코드) ...
            // 중요: 접속할 때 streamPath 변수를 사용합니다!
            
            // 예시: 서버에 접속 요청을 보낼 때
            fetch('http://returnfeed.net:8889/' + streamPath + '/whep', {
                method: 'POST',
                // ...
            });
        } else {
            document.body.innerHTML = "<h1>잘못된 접근입니다.</h1>";
        }
    </script>
</body>
</html>
IGNORE_WHEN_COPYING_START
content_copy
download
Use code with caution.
Html
IGNORE_WHEN_COPYING_END
전체 흐름 정리

PD user_A 로그인: PD앱이 user_A라는 아이디로 로그인합니다.

PD user_A 방송 시작: PD앱은 srt://.../publish:pgm_user_A 주소로 방송을 시작합니다.

MediaMTX: pgm_user_A 라는 이름의 스트림을 수신하고 WebRTC로 변환할 준비를 합니다.

스태프 접속: 스태프가 웹 브라우저에 http://returnfeed.net/user_A 주소를 입력합니다.

NGINX 안내: NGINX는 이 요청을 보고, viewer.html 파일을 스태프의 브라우저에 보내줍니다.

스마트한 웹페이지 작동:

viewer.html 페이지의 JavaScript 코드가 실행됩니다.

코드는 현재 주소(.../user_A)를 보고 user_A라는 아이디를 추출합니다.

추출한 아이디로 pgm_user_A라는 스트림 경로를 만듭니다.

pgm_user_A 경로로 MediaMTX 서버에 WebRTC 영상 연결을 요청합니다.

연결 성공: 스태프는 user_A가 보내는 PGM 영상과 탈리 정보를 보게 됩니다.

user_B가 접속하면 모든 과정에서 user_A가 user_B로 바뀌어 똑같이 동작합니다. 이렇게 하면 수백, 수천 개의 개인화된 주소를 만들어낼 수 있습니다.



